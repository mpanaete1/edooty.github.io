<h1>Red Hat Certified System Administrator Study Guide (EX200)</h1>

[Home](index.html)

 created and used this study guide and passed RHCSA. RHCA Version 8

[toc]

## Objectives

### Understand and use essential tools

<a href="ex200.html">Top</a>

#### Access a shell prompt and issue commands with correct syntax

use <tab> <tab>, man pages, -h, info on commands you need help with

#### Use input-output redirection (>, >>, |, 2>, etc.)

| Command                              | Description                                                  |
| ------------------------------------ | ------------------------------------------------------------ |
| `echo “text OR file” > newfile.txt`  | create a file                                                |
| `echo “text OR file” >> newfile.txt` | add to/append to a file                                      |
| `find / -name *.txt 2>/dev/null`     | redirects errors to null                                     |
| `|`                                  | take the output of the first command and send to second command `cat /etc/passwd | less` |

#### Use grep and regular expressions to analyze text

| Command                     | Description                                                  |
| --------------------------- | ------------------------------------------------------------ |
| `cut -d : -f 1 /etc/passwd` | displays first column of /etc/passwd : as separator          |
| `wc`                        | show lines,words, characters        90 (lines) 1045 (words) 7583(characters) |
| `grep`                      | search for term or regexp                                    |
|                             | `^ann`  begin with ann                                       |
|                             | `ann$`  end with ann                                         |
|                             | `-v ann` dont display ann, `-r` search through all directory, `-e` more than 1 reg expression |
|                             | `.` any single char, `[abc]` a b or c, `\{2\}` matches exactly 2 of previous character |

#### Access remote systems using SSH

| Command                               | Description                           |
| ------------------------------------- | ------------------------------------- |
| `ssh username@remote`                 | use a password to login using ssh     |
| `ssh -i .ssh/key.pub username@remote` | use ssh key to login to remote system |

#### Log in and switch users in multiuser targets

| Command           | Description                            |
| ----------------- | -------------------------------------- |
| `su - <username>` | switch user                            |
| ``sudo -i` `      | change to root , provide root password |

#### Archive, compress, unpack, and uncompress files using tar, star, gzip, and bzip2

| Command                           | Description                                                  |
| --------------------------------- | ------------------------------------------------------------ |
| `tar`                             |                                                              |
| `-cvf name.tar /file/to/be/tar’d` | create tar                                                   |
| `	-xvf name.tar`               | extract tar, best to copy .tar to directory and cd into it   |
| `-rvf .tar /file/to/add`          | add file to archive                                          |
| `-cjvf name.tar /what/to/tar`     | creates bzip2 compression. Using tar will automatically decompress bzip2 or use `bunzip2` |
| `-czvf name.tar /what/to/tar`     | creates gzip compression. tar will automatically decompress gzip or use `gunzip` |

#### Create and edit text files

<a href="ex200.html">Top</a>

Always use  `vim <file>`
			`dd` delete line
			`yy` copy line
			`P`   paste line
			`V `   for visual mode

#### Create, delete, copy, and move files and directories

| Command                                                      | Description             |
| ------------------------------------------------------------ | ----------------------- |
| `touch <file>` or `echo "text" > file.txt` or `vim /path/file` | create files            |
| `rm <file>` add  `-r`  to remove directories                 | remove file/directories |
| `cp <source> <destination>`  you can also rename with cp     | copy or rename          |
| `mv <source> <destination>`                                  | move or rename files    |


​	*Use `-r` in most situations to move directories and all files 

#### Create hard and soft links

`ln source/ <hardlinkname>`
`ln -s source/ <softlinkname>`

#### List, set, and change standard ugo/rwx permissions

`chown user:group /file/directory` 							change <user>:<group> ownership
`chmod 755 /file/directory`      								      change permissions
* R(4), W(2), X(1)

* 750 - User RWX, Group RX, Other None

`chmod g+s /file/directory`  					 add special permissions, file gain permissions of group permissions
`chmod o+t /file/directory` 					  user can only delete the files they create no one else's
`ls -latr /file` , `ls -ld /directory`	  list info for files/directories

#### Locate, read, and use system documentation including man, info, and files in /usr/share/doc

| Command                             | Description                                                  |
| ----------------------------------- | ------------------------------------------------------------ |
| `man <command>`                     | manual/help pages                                            |
| `man -k <command>`                  | shows different man pages for that command                   |
| `info <command>`                    | another way to get help. may need to install it              |
|                                     | space for next page, highlight section and enter, p for previous page |
| `ls /usr/share/doc |grep <package>` | often contain configuration files                            |

### Create simple shell scripts (starts with #!/bin/bash end exit 0)

<a href="ex200.html">Top</a>

Make script executable `chmod +x script.sh`, run `./script.sh`

#### Conditionally execute code (use of: if, test, [], etc.)

Use Looping constructs (for, etc.) to process file, command line input
`for i in 1 2 3 4; do useradd -G <sup group> username$i; done`
Process script inputs ($1, $2, etc.)
$1, $2 are the arguments provided to the script

#### Processing output of shell commands within a script

You can add > to commands in script to output to file

#### Processing shell command exit codes

`exit 0`



### Operate running systems

<a href="ex200.html">Top</a>

#### Boot, reboot, and shut down a system normally

`systemctl reboot`
`systemctl poweroff`

#### Boot systems into different targets manually

| Command                                                      | Description                      |
| ------------------------------------------------------------ | -------------------------------- |
| `systemctl get-default`                                      | get default target               |
| `systemctl isolate <mutli-user.target|graphical.target>`     | set target interactively         |
| `systemctl set-default multi-user.target|graphical|rescue.target` | set target                       |
| `systemctl reboot`                                           | reboot for target to take effect |

#### Interrupt the boot process in order to gain access to a system

Fix mount issue: 

1. `e` at grub loader

2. at the end of the linux line append `systemd.unit=emergency` 
3. `ctrl +x` to reboot
4. enter root password for maintenance
5. remount filesystem to rw  `mount -o remount,rw /`
6. analyze /etc/fstab and fix/comment out issues 
7. reboot

Reset Root pass: 

1. `e` at grub loader,
2. at the end of the linux line append `rd.break`
3. `ctrl + x` to reboot
4. remount filesystem to rw  `mount -o remount,rw /sysroot`
5. change root `chroot /sysroot`
6. `passwd <newpassword>` 
7. set up system to relabel (SELinux)   `touch /.autorelabel`
8.  reboot

#### Identify CPU/memory intensive processes and kill processes

`top`    show live view of processes

​	 `c`  sort by cpu usage, `m` sort by memory usage , `k` to kill process, followed by PID and enter

`kill <-9|SIGKILL> <PID>`

#### Adjust process scheduling

`renice -n <#|10> <PID>`    change priorty level of a process
* Changes priority within SYSTEM_OTHER only
* -20 (highest priority) , 0 (default), 19 (lowest priority)
* you can also use top with `r` to renice

#### Processes scheduling/policy

`chrt -p <PID>` 										retrieve real time attributes of a task/process
`chrt -r|b|f -p <priority> <PID>`	changes priority class and level of process policy
																  	`-f` for first in first out, `-b` for batch
`chrt -m` 													 see priorities and expected range (min-max)

#### Manage tuning profiles

<a href="ex200.html">Top</a>

ensure  tuned service is enabled and running/started `yum install tuned`, systemctl start and enable tuned
	`tuned-adm active`  						show current profile
	`tuned-adm recommend`					shows recommended profile
	`tuned-adm profile <choice>` 	change tuned profile

#### Locate and interpret system log files and journals

| Command                                                      | Description                                                  |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| `/var/log`                                                   | log location                                                 |
| `/var/log/audit/audit.log`                                   | selinux logs                                                 |
| `sealert -a /var/log/audit/audit.log`                        | search through selinux errors/alerts                         |
| `systemctl status <service|sshd> -l`                         | Show relevant log information (shows at bottom)              |
| Log elements                                                 | Date and Time \|  host \| Serice/Process \| Message Content  |
| `tail -f </log/location>`                                    | monitor logs                                                 |
| `logger "message"`                                           | writes to rsyslog                                            |
|                                                              | Specify priority and facility  with `-p` (like kern.error, debug) |
| `man 5 rsyslog`                                              | read rsyslog man page for info    `man logrotate`            |
| `journalctl`                                                 | shows recent events (<tab> <tab> for more info)              |
|                                                              | `-f` show last lines                                         |
|                                                              | `G` go to the end of the log                                 |
|                                                              | `-p`  errors only                                            |
| `journalctl --since YYYY-MM-DD hh:mm:ss --until YYYY-MM-DD hh:mm:ss` | you can also use Today, Yesterday in place of date           |
| `_SYSTEM_UNIT=sshd.service`                                  | show info about a specific service                           |

Preserve system journals

1. `mkdir /var/log/journal`

2. Configure `/etc/systemd/journal.conf` 

   ​	Storage = auto/persistent/none/volatile. auto will work in most situations

3. `chown root:systemd-journal /var/log/journal`

4. `chmod 2755 /var/log/journal`

5. `systemctl restart systemd-journald`

#### Start, stop, and check the status of network services

| Command                             | Description                                         |
| ----------------------------------- | --------------------------------------------------- |
| `ip addr`    `ip -s link show`      | check status                                        |
| `ip link set dev <eth0> up` or down | start/stop links                                    |
| `ping -c2 <IP>`                     | ping target                                         |
| `ss -auntp`                         | just like netstat -auntp (show network connections) |

#### Securely transfer files between systems

`scp </source/file.txt> <username>@<remote servername>:</destination/location>`
	Use `-i .ssh/key` for key authentication



### Configure local storage

<a href="ex200.html">Top</a>

#### List, create, delete partitions on MBR and GPT disks

**`fidsk /dev/device (MBR)`**

| Option | Description                                                  |
| ------ | ------------------------------------------------------------ |
| `h`    | help                                                         |
| `n`    | New partition                                                |
| `p`    | list/display or `fidsk -l /dev/device`                       |
| `t`    | for type, then L to list all available types 83 (linux), 82 (swap), 8e(lvm) |
| `d`    | delete a partition                                           |
| `w`    | write changes to partition/disk                              |

**`gdisk /dev/device` (GPT)**

| Option | Description                                                  |
| ------ | ------------------------------------------------------------ |
| `?`    | help                                                         |
| `n`    | new partition                                                |
| `w`    | write changes to partition/disk                              |
| `p`    | list/display disk information                                |
| `d`    | delete a partition                                           |
| `L`    | list all available types 8300 (linux), 8200 (swap), 8e00 (lvm) |

#### Create and remove physical volumes (PV)

| Description                                              | Command                  |
| -------------------------------------------------------- | ------------------------ |
| create a Physical Volume. Initialize disk for use by LVM | `pvcreate /dev/<device>` |
| show physical volumes                                    | `pvs`                    |
| remove physical volumes                                  | `pvremove /dev/<device>` |

#### Assign Volume Groups (VG) to Physical Volumes (PV)

| Description                                | Command                                            |
| ------------------------------------------ | -------------------------------------------------- |
| create a volume group on a physical volume | `vgcreate <vgname> /dev/sdb1`                      |
|                                            | `-s` to specify physical extends                   |
| remove volume group                        | `vgremove <vgname>`                                |
| display volume groups                      | `vgs`                                              |
| extend a volume group                      | `vgextend <vgname> /dev/sdb21`                     |
| reduce the size of a volume group          | `vgreduce <vgname> /dev/sdb1  (only works on GPT)` |

#### Create and delete logical volumes (LV)

| Description             | Command                                                      |
| ----------------------- | ------------------------------------------------------------ |
| create a logical volume | `lvcreate -L +#GB -n <lvname> <vgname> /dev/sdb1`            |
|                         | make sure to you the + to specify size of the LV. +1MB, +2GB ... etc |
| remove Logical Volume   | `lvremove /dev/sdb1/<lvname>`                                |

#### Format newly created partions/LV's with filesystems

| Description                                             | Command                                                      |
| ------------------------------------------------------- | ------------------------------------------------------------ |
| create a xfs filesystem on newly created Logical Volume | `mkfs -t xfs /dev/mapper/<vgname>/<lvname>`                  |
|                                                         | `lsblk` to verify                                            |
|                                                         | `-L <label>` to give your filesystem a label used instead of UUID |

#### Configure systems to mount file systems at boot by universally unique ID (UUID) or label

1. Get the uuid of the device to add to fstab

   ​		`lsblk -o UUID /dev/<device>`  	

2. Create mount point

   ​		`mkdir /mountpoint`

3. `vim /etc/fstab` at the bottom add:

   ​		`UUID= <uuid found above>    /mountpoint       <filesystem|xfs|ext4>          defaults       0   0` 

#### Add swap to LV adding to /etc/fstab (non-destructively)

1. `lvcreate -n <name|swap1> -L +2G <vgname>`

2. `mkswap /dev/<vgname>/swap1`

   ​	`-L <label>` to add a label to your swap 

3. `swapon /dev/<vgname>/swap1`
       `swapon -s` to verify

   ​          `swapon -a`  turn on all swaps
   ​          `swapoff /dev/<vgname>/swap1`  to remove

4. Add to /etc/fstab

   ​          `vim /etc/fstab` at the end add:

   ​		  `UUID=<uuid found with lsblk -o UUID>      swap       swap        defaults        0     0

   

### Create and configure file systems

<a href="ex200.html">Top</a>

#### Create, mount, unmount, and use vfat, ext4, and xfs file systems

| Command                                                   | Description                                          |
| --------------------------------------------------------- | ---------------------------------------------------- |
| `mkfs -t xfs,ext4,vfat /dev/<vgname>/<lvname> -L <label>` | create filesystems on LVM                            |
| `xfs_admin -L <newlabel> /dev/device`                     | add a label to xfs                                   |
| `mount /dev/<vgname>/<lvname> /mountpoint`                | mount destructivley (will not persist when rebooted) |
| `umount /mountpoint`                                      | un mount a mount                                     |
| for persistent mount see step 3  (mount by UUID)          |                                                      |

#### Mount and unmount network file systems using NFS

| Command                                                      | Description                               |
| ------------------------------------------------------------ | ----------------------------------------- |
| `showmount -e <host>`                                        | show mounts on remote/local server        |
| `yum install nfs-utils`                                      | install nfs-utils                         |
| `mount -t nfs <IP/FQDN>:/remoteshare/location /mountlocation` | mount the share location to a mount point |
| `umount /mountlocation`                                      | un mount the nfs mount                    |
| `vim/fstab`                                                  | persistent nfs mount                      |

```
	 IP/FQDN:/remoteshare/location /mountpoint  nfs  rw.sync  0  0		
```

#### Extend existing logical volumes

`vgdisplay` `lvdisplay` to ensure you have enough space
	`lvextend -L +1GB /dev/<vgname>/<lvname>`
Extend filesystem - check with `df -Th`
	`xfs_growfs /dev/<vgname>/<lvname>`

#### Create and configure set-GID directories for collaboration

1. `groupadd <group>`
2. `chown user:group /directory`
3. `chmod g+s /directory`
4. `chmod 770 /directory`

#### Configure disk compression

​       install vdo and kmod-kvod for disk compression

1. `yum install vdo kmod-kvdo`			

   create the vdo on devise and specify logical size																				                   	

2. `vdo create --name=<name> --device=/dev/<device> --vdoLogicalSize=30GB`	                   

   add a filesystem to vdo disk

3. `mkfs -t xfs -K /dev/mapper/<vdoname>`			

   make persistent in /etc/fstab																		       

4. `UUID=<UUID>  /mountpoint  xfs   defaults,x-systemd.requires=vdo.service   0   0`   

#### Manage layered storage (stratis(xfs) - local storage manag. Auto grow,snapshots)

| Command                                           | Description                                                  |
| ------------------------------------------------- | ------------------------------------------------------------ |
| `yum install stratisd stratis-cli`                | install startisd and stratis-cli                             |
| `systemctl status|start|enable stratisd`          | start, enable, and check status of stratisd                  |
| `stratis pool create <stratisname> /dev/sdb`      | create statris pool you can add mulitple /devs if you want   |
| `stratis fs create <stratisname> fs1`             | create a filesystem on stratis with the name of fs1          |
| `stratis fs list <stratisname>`                   | list info on the stratis device                              |
| `mount /stratis/<stratisname>/fs1` `/mount point` | mount destructivley                                          |
| `stratis pool add-data <stratisname> /dev/to/add` | add additional data to stratis pool                          |
| `stratis fs snapshot <stratisname> fs1 snapshot1` | create a snapshot of your stratis pool (you can mount the snapshot) |
| `stratis fs destroy <stratisname>`                | destroy statis device                                        |

add to fstab for a persistent mount

```
uuid=<UUID>   /mnt    xfs    defaults,x-systemd.requires=stratisd.service     0   0
```

#### Diagnose and correct file permission problems

`ls -latrh` , or use `getfacl <file/directory to check>`
`chmod` and `chown` to fix/edit permissions
Edit default umask (more on [umask](rh124.html))
	As the user  `echo “umask 0700” > ./bashrc` AND  `echo “umask 0700” >./bash_profile`

### Deploy, configure, and maintain systems

<a href="ex200.html">Top</a>

#### Schedule tasks using at and cron

| Command                  | Description                                  |
| ------------------------ | -------------------------------------------- |
| `systemctl status crond` | check status of crond                        |
| `at <time|noon|teatime>` | schedule a job to run once                   |
|                          | enter command to run then `Ctrl +D ` to exit |
|                          | `at`q  to see jobs scheduled                 |
| `crontab -e`             | create chron job                             |

```
Min (0-59)    hour(0-23)    dayofmonth(1-31)  month(Jan-Dec)    dayofweek(1-5|Mon-Fri)0Sun,6Sat)

    	0 */2 * * *   would set for every 2 hours

		* * * * * message or command to run
```



#### Start and stop services and configure services to start automatically at boot

| Command                              | Description                     |
| ------------------------------------ | ------------------------------- |
| `systemctl stop <service>`           | stop service                    |
| `systemctl start <service>`          | start service                   |
| `systemctl reload|restart <service>` | reload /restart service         |
| `systemctl enable <service>`         | enable service to start at boot |

#### Configure time service clients

Configure network time protocol in `/etc/chrony.conf`
`timedatectl set-ntp 1`										 enable ntp services (if error, `yum -y install chrony`)	

* set-time			
* set-timezone (tzselect)

   * set-ntp

Service clients in chrony config 

​	`systemctl start|enable|status chrony`

​	`vim /etc/chrony.conf`
​	`cat /etc/chrony.conf | grep servers`

​	add in Public pool the ip/server to add

#### Install and update software packages from Red Hat Network, a remote repository, or from the local file system

Add repository
	`vim /etc/yum.repos.d/<name>.repo`

```
[name]
name= <name>
baseurl= repository.example.com
gpgcheck=0 
gpgkey=<key>
```

| Command                                                | Description                                         |
| ------------------------------------------------------ | --------------------------------------------------- |
| `yum search <package>`                                 | search for a package                                |
| `yum repolist all`                                     | list repos                                          |
| `yum repoinfo <package>`                               | get repo information                                |
| `yum remove <package>`                                 | remove a package                                    |
| `yum provides "/bin/package | program"`                | see what packages are provided to a package/command |
| `yum localinstall <package name>`                      | install a package installed locally                 |
| `yum group list|remove|install`                        | list / remove/install group packages                |
| `yum-config-manage --add-repo http://repo.example.com` | add a repo using yum-config-manage                  |
|                                                        | `--disablerepo` | `--enablerepo <repo>`             |

Add a package to local directory

1. `yum install createrepo`
2. `mkdir /root/local_repo`
3. copy package to /root/local_repo
4. `createrepo --database /root/local_repo`
5. `yum-config-manage --add-repo file:///root/local_repo`

#### Work with package module streams

| Command                            | Description                                         |
| ---------------------------------- | --------------------------------------------------- |
| `yum module list`                  | list package modules                                |
| `yum module info --profile php`    | get module information                              |
| `yum module install php`           | install module                                      |
| `yum module remove php`            | remove module                                       |
| `yum module reset php`             | reset module                                        |
| `yum module list | grep <package>` | Install package based on module (specific versions) |
|                                    | `yum module install php:7.3/minimal`                |

#### Modify the system bootloader

1. `vim /etc/default/grub`  remove rhgb and quite

2. `grub2-mkconfig -o </boot/efi/efi/redhat/grub.cfg or boot/grub2/grub.cfg>` to apply the changes

3. Install grub `grub2-install /dev/<vda|sda>`

### Manage basic networking

<a href="ex200.html">Top</a>

#### Configure IPv4 and IPv6 addresses

open console to whatever server you are configuring the network on <u>NO SSH</u>

`nmcli con show`			show connection profiles status

```
# Add a connection profile with IPv4, Gateway
nmcli con add con-name <name> type ethernet ifname <eth0|en3> ipv4.method auto|manual(no dhcp) ip4 <IP/CIDR> gw4 <GateIP>
```

`nmcli con up <profile>` 											     bring up newly created connection

Add/modify new connection 

  `nmcli con mod <name> +ipv4.address <IP/CIDR>`	   add an ipv4 address to a profile
  `nmcli con up <name>`
  `man nmcli-examples`														      get examples for nmcli

#### Configure hostname

`hostnamectl set-hostname <server.example.com>`
`hostnamectl status`  														show current hostname

#### Configure hostname resolution

`vim /etc/hosts`
`<IP> <hostname use FQDN>` and optional alias(cname) server1
Check with `getent hosts <servername>`

#### Configure network services to start automatically at boot

`systemctl enable|disable <service>`                                        start and disable at boot
`nmcli con mod <name> connection.autoconnect yes|no`      connection starts automatically
This is for any connection profiles (nmcli con show)

#### Restrict network access using firewall-cmd/firewall

| Command                                                      | Description                                          |
| ------------------------------------------------------------ | ---------------------------------------------------- |
| `firewall-cmd --zone <zone> --list-all`                      | show zone information                                |
| `firewall-cmd --new-zone <newzonename> --permanent`          | add a new firewall zone                              |
| `firewall-cmd --reload`                                      | always reload firewall when adjusting firewall rules |
| `firewall-cmd --zone <zonename> --add-service=ssh --permanent` | add a service to a zone                              |
| `firewall-cmd --change-interface=eth2 --zone=<zonename> --permanent` | change interface for a zone                          |
| `firewall-cmd --add-source=<IP/cidr> --zone=block --permanent` | block an IP                                          |
| `firewall-cmd --set-default-zone=<zonename>`                 | set default zone                                     |
| `firewall-cmd --add-port 8080/tcp --permanent --zone=<zonename>` | add port to a zone                                   |
| `firewall-cmd --remove-service ssh --permanent`              | remove a service from a zone                         |
| `firewall-cmd --remove-port 8080/tcp --permanent`            | remove a port from a zone                            |

### Manage users and groups

<a href="ex200.html">Top</a>

#### Create, delete, and modify local user accounts

| Command                                     | Description                                        |
| ------------------------------------------- | -------------------------------------------------- |
| `useradd -G <supp group to add> <username>` | create a user adding them to a supplimentary group |
| `userdel <username>`                        | delete a user                                      |
| `usermod -a -G <supp group> <username>`     | modify a user adding them to another group         |

Create files in `/etc/skel` to have them show up in all newly created users home(~) accounts

#### Change passwords and adjust password aging for local user accounts

more on [Users](basic_linux.html)

`vim /etc/login.defs` 																change default  UID/GID min and max, and password age
chage to change user password policy
					`-d`   0 (change password immediately)
					`-m`   min days between password change
					`-M`   max days between password change

#### Create, delete, and modify local groups and group memberships

| `Command`                       | `Description`                               |
| ------------------------------- | ------------------------------------------- |
| `groupadd <groupname>`          | `add a group`                               |
|                                 | `-g <GID> <groupname>  to specify group id` |
| `groupdel` <groupname>          | `remove group`                              |
| `groupmod<options> <groupname>` | modify a group  `-h` for help               |

#### Configure Superuser(root) access

```
vim /etc/sudoers.d/<username>
	<username> ALL=(ALL) ALL

#ALL=(ALL) NOPASSWD:ALL to not require a password
```

### Manage security

<a href="ex200.html">Top</a>

#### Create and use file access control lists

| Command                                    | Description                                                  |
| ------------------------------------------ | ------------------------------------------------------------ |
| `getfacl <file/directory>`                 | check acls                                                   |
| `setfacl -m u:<username>:rwx /directory`   | set/modify acl to give a user rwx perms on a directory       |
| `setfacl -m d:u:<username>:rwx /directory` | set/modify acl to set default permissions for a user on a directory |
| `setfacl -x <file/directory>`              | remove acls                                                  |
| `-R`                                       | to set permissions for all files in a directory              |

#### Configure key-based authentication for SSH

1. Login as user 
2. `ssh-keygen` (you can specific name of the key:  .ssh/<name>)
3.  send key to remote host: `ssh-copy-id -i .ssh/<key.pub> remote@host`
4. `vim /etc/ssh/sshd_config`
              AllowRootLogin=no,  PasswordAuthenication =no
5. `systemctl reload sshd`

#### Set enforcing and permissive modes for SELinux

`setenforce (1|0)`, `getenforce` to check OR vim `/etc/selinux/conf`

#### List and identify SELinux file and process context

| Command                                         | Description                                 |
| ----------------------------------------------- | ------------------------------------------- |
| `ls -Z`, `ps -Z`                                | view selinux context on files and processes |
| `semanage fcontext -l | grep <context>`         | list file contexts and grep for a pattern   |
| `semanage port -l | grep <port service| http>`  | list ports for a specific service           |
| `semanage port -a -t http_port_t -p tcp <port>` | add a port to the http service              |
| `chcon unconfirmed-u:object-r:tmp_t:s0 <file>`  | change context on a file                    |

#### Restore default file contexts

`restorecon /directory` (-R for recursive)

#### Use boolean settings to modify system SELinux settings

| Command                          | Description                                                  |
| -------------------------------- | ------------------------------------------------------------ |
| `ls /sys/fs/selinux/booleans`    | boolean location                                             |
| `getsebool -a | grep <bool>`     | show all booleans and grep for pattern                       |
| `getsebool -L`                   | more info on booleans                                        |
| `setsebool -P use_virtualbox on` | sets the current state of a particular boolean, -P make it perminent |

#### Diagnose and address routine SELinux policy violations

1. Try to get status or restart service `systemctl restart/status service`
2. “Could not bind” check: `sealert -a /var/log/audit/audit.log`
3. Add port with semanage: `semanage port -a -t <http_port_t> -p tcp <port>`
4. Restart service and check again for erros
5. Add to firewall: `firewall-cmd --add-port=<port>/tcp --permanent`
6. `firewall-cmd --reload`

### Manage containers

<a href="ex200.html">Top</a>

#### Create rootless container 

a rootless container is a user that can run sudo container commands

​	create and login as a user you want to use to manage containers on your system

​	`useradd containerManager`

​	create a directory to store and manage containers

​	`mkdir /containers`

​	`chown -R containerManager: /containers`

#### Find and retrieve container images from a remote registry

| Command                                | Description                                              |
| -------------------------------------- | -------------------------------------------------------- |
| `yum module install container-tools`   | install container tools                                  |
| `podman login <repository.redhat.com>` | login to repository, need to enter username and password |
| `podman info`                          | get info on a container                                  |
| `podman search <http/mariadb>`         | search for a podman container                            |
|                                        | You can also search by repository                        |

#### Inspect container images

`skopeo inspect`														   inspect information about and image withing a registry													

`podman inspect` after a `podman pull`					inspect a container after you pull it from a registry
`podman images` 															list images in local storage

#### Perform container management using commands such as podman and skopeo/attach persistent storage/port forwarding/run service inside container

```
podman run -d --name <name> -p HostPort:serviceport -v /new/mount:/servicemount:Z -e environment=event <registry>
```

| Option                       | Description                                                  |
| ---------------------------- | ------------------------------------------------------------ |
| `-d`                         | run the container in the background                          |
| `--name`                     | specify name for your cont                                   |
| `-p`                         | port redirection  (ContainerPort:HostPort)                   |
| `-v`                         | directory pointers  src volume to host volume     `/src/web:/var/www` |
| `-Z`                         | maintains selinux labels                                     |
| `-e`                         | set environment variable                                     |
| End registry/service/version | this will be the podman image registry you logged into followed by the service and version |

`podman logs <container name>` 														check logs (check for any errors with -e)

Don't forget to add port to firewall and reload:

​		 `firewall-cmd --add-port hostport/tcp --permanent`
​		 `firewall-cmd --reload`

#### Perform basic container management such as running, starting, stopping, and listing running containers

| Command                                 | Description                                                  |
| --------------------------------------- | ------------------------------------------------------------ |
| `podman stop`                           | send sigterm, stop the container                             |
| `podman restart, start`                 | restart or start podman container                            |
| `podman rm`                             | remove a container                                           |
| `podman ps`                             | show containers,  use ps -all to show all containers even stopped ones |
| `podman exec`                           | run commands inside a container                              |
|                                         | podman exec <containername> uname -a                         |
| `podman exec -it <cont name> /bin/bash` | get shell , `exit` to exit                                   |

#### Configure a container to start automatically as a systemd service

1.  login directly with ssh instead of su 

 	`ssh  containerManager@<remote location>`

2.  create systemd directory for the user (notice the name is actually user not the username name)

​	`mkdir -p ~/.config/systemd/user`

3.  run podman generate systemd to create systemd unit file from running container

​	`cd ~/.config/systemd/user`

​	`podman generate systemd --name <name> --files --new`

4.  test by stoping and deleting the container.

​	`podman stop <name>`
​	`podmane rm <name>`

5. use systemctl to reload config and enable/start the container

​	``systemctl --user daemon-reload`
​	`systemctl --user enable --now container-<name>.service`

6. confirm the container is running 

		`curl http://localhost:<container port>`

7. run the `loginctl` command for the services to start automatically

​		`loginctl enable-linger`

### Configure Rsyslog to log all messages to specific priority

<a href="ex200.html">Top</a>

```
sudo vim /etc/rsyslog.d/<name>.conf
	*.debug <log location>

#Restart Rsyslog
sudo systemctl restart rsyslog

#Test
logger -p debug "Debug Test"
sudo tail <log location>
```

### Use a directory to store tmp files (delete after a specific time)

Files are subject to cleanup if not accessed in a specific time

```
# Create tmp volatile file with the following
# tmp files stored here will delete after 30s if not accessed

vim /etc/tmpfiles.d/volatile.conf
	d	<directory>	  <octal perms/0700> 	root	root 	<time|30s>

	
# cd into <directory> and run

systemd-tmpfiles --create /etc/tmpfiles.d/volatile.conf
```

### Autofs to automate directories

automatically mount the home directory when a user logs in.

adjust selinux to allow user access to the NFS-mounted directory using SSH key authentication.

	1.  systemctl status nfs-server
	2.  yum install autofs
	3.  create master autofs map file
	 		`vim /etc/auto.master.d/<name>.autofs`
	 				`/- /etc/auto.<name>`
	4.  get the details of a user's home directory path
	 	`getent passwd <username>`
	5.  create the auto.<name> file 
	 	`vim /etc/auto.<name>`
	 				`<home directory found with getent>  -rw  <remote domain>:<network file location>`
	6.  restart the autofs service
	 	`systemctl restart autofs`
	7.  set appropriate SELinux Boolean so that <name> can login to remote location using ssh public keys 
	   	`sudo setsebool -P use_nfs_home_dirs true`

